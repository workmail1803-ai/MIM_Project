{% extends 'base.html' %}
{% load static %}

{% block title %}{% if is_admin_view %}Messages Inbox{% else %}Contact Us{% endif %} - Wond'r NEUB{% endblock %}

{% block content %}
<div class="container">
    {% if is_admin_view %}
    <!-- Admin Message Inbox View -->
    <section class="hero-section" style="background: linear-gradient(135deg, #667eea, #764ba2);">
        <div class="hero-content">
            <h1><i class="fas fa-inbox"></i> Message Inbox</h1>
            <p>View and manage messages from students and users</p>
            {% if unread_count > 0 %}
            <div style="margin-top: 20px; background: rgba(255,255,255,0.2); display: inline-block; padding: 10px 25px; border-radius: 25px;">
                <i class="fas fa-envelope"></i> {{ unread_count }} unread message{{ unread_count|pluralize }}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Messages List -->
    <section class="messages-section" style="margin-bottom: 60px;">
        {% if contact_messages %}
        <div class="messages-container">
            {% for msg in contact_messages %}
            <div class="message-card {% if msg.status == 'unread' %}unread{% endif %}" style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); border-left: 5px solid {% if msg.status == 'unread' %}#e74c3c{% elif msg.status == 'read' %}#f39c12{% else %}#27ae60{% endif %};">
                <div class="message-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <h3 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.3rem;">
                            <i class="fas fa-user-circle" style="color: var(--primary);"></i> {{ msg.full_name }}
                        </h3>
                        <p style="color: #7f8c8d; margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-envelope"></i> {{ msg.email }}
                            {% if msg.phone %} | <i class="fas fa-phone"></i> {{ msg.phone }}{% endif %}
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="background: {% if msg.status == 'unread' %}#e74c3c{% elif msg.status == 'read' %}#f39c12{% else %}#27ae60{% endif %}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                            {% if msg.status == 'unread' %}<i class="fas fa-circle"></i>{% elif msg.status == 'read' %}<i class="fas fa-eye"></i>{% else %}<i class="fas fa-check-double"></i>{% endif %}
                            {{ msg.get_status_display }}
                        </span>
                        <span style="background: #f8f9fa; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; color: #666;">
                            {{ msg.created_at|date:"M d, Y H:i" }}
                        </span>
                    </div>
                </div>
                
                <div class="message-subject" style="margin-bottom: 15px;">
                    <span style="background: linear-gradient(135deg, var(--primary), #28a65e); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem;">
                        <i class="fas fa-tag"></i> {{ msg.get_subject_display }}
                    </span>
                    {% if msg.user %}
                    <span style="background: #17a2b8; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; margin-left: 10px;">
                        <i class="fas fa-user-check"></i> Registered User
                    </span>
                    {% endif %}
                </div>
                
                <div class="message-body" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <p style="color: #333; line-height: 1.8; margin: 0; white-space: pre-wrap;">{{ msg.message }}</p>
                </div>
                
                <div class="message-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    {% if msg.status == 'unread' %}
                    <a href="{% url 'mark_message_read' msg.id %}" class="action-btn" style="padding: 10px 20px; background: #f39c12; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s;">
                        <i class="fas fa-eye"></i> Mark as Read
                    </a>
                    {% endif %}
                    {% if msg.status != 'replied' %}
                    <a href="{% url 'mark_message_replied' msg.id %}" class="action-btn" style="padding: 10px 20px; background: #27ae60; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s;">
                        <i class="fas fa-check-double"></i> Mark as Replied
                    </a>
                    {% endif %}
                    <a href="mailto:{{ msg.email }}?subject=Re: {{ msg.get_subject_display }}" class="action-btn" style="padding: 10px 20px; background: #17a2b8; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s;">
                        <i class="fas fa-reply"></i> Reply via Email
                    </a>
                    <a href="{% url 'delete_message' msg.id %}" class="action-btn" style="padding: 10px 20px; background: #e74c3c; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s;" onclick="return confirm('Are you sure you want to delete this message?');">
                        <i class="fas fa-trash"></i> Delete
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08);">
            <i class="fas fa-inbox" style="font-size: 60px; color: #ccc; margin-bottom: 20px;"></i>
            <h3 style="color: #666; margin-bottom: 10px;">No Messages Yet</h3>
            <p style="color: #999;">When students send messages, they will appear here.</p>
        </div>
        {% endif %}
    </section>

    {% else %}
    <!-- Student/User Contact Form View -->
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1>Get In Touch</h1>
            <p>We're here to help you plan your perfect journey. Reach out to us with any questions or concerns.</p>
        </div>
    </section>

    <!-- Contact Info Section -->
    <section class="contact-info">
        <div class="info-container">
            <div class="info-card">
                <div class="info-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <h3>Visit Our Office</h3>
                <p>North East University Bangladesh</p>
                <p>Telihaor, Sheikhghat, Sylhet-3100</p>
                <p>Bangladesh</p>
            </div>
            <div class="info-card">
                <div class="info-icon">
                    <i class="fas fa-phone-alt"></i>
                </div>
                <h3>Call Us</h3>
                <p>+880 02996631220</p>
                <p>+880 01712345678</p>
                <p>+880 01898765432</p>
            </div>
            <div class="info-card">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <h3>Email Us</h3>
                <p>info@wondrneub.edu.bd</p>
                <p>support@wondrneub.edu.bd</p>
                <p>bookings@wondrneub.edu.bd</p>
            </div>
            <div class="info-card">
                <div class="info-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3>Office Hours</h3>
                <p>Sunday - Thursday: 9:00 AM - 5:00 PM</p>
                <p>Friday: 9:00 AM - 1:00 PM</p>
                <p>Saturday: Closed</p>
            </div>
        </div>
    </section>

    <!-- Contact Form & Map Section -->
    <section class="contact-main">
        <div class="contact-wrapper">
            <!-- Contact Form -->
            <div class="form-section">
                <div class="form-header">
                    <h2>Send us a Message</h2>
                    <p>Fill out the form below and we'll get back to you within 24 hours.</p>
                </div>
                <form class="contact-form" method="POST">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_first_name">First Name *</label>
                            {{ form.first_name }}
                        </div>
                        <div class="form-group">
                            <label for="id_last_name">Last Name *</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="id_email">Email Address *</label>
                        {{ form.email }}
                    </div>
                    <div class="form-group">
                        <label for="id_phone">Phone Number</label>
                        {{ form.phone }}
                    </div>
                    <div class="form-group">
                        <label for="id_subject">Subject *</label>
                        {{ form.subject }}
                    </div>
                    <div class="form-group">
                        <label for="id_message">Message *</label>
                        {{ form.message }}
                    </div>
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-paper-plane"></i>
                        Send Message
                    </button>
                </form>
            </div>

            <!-- Map Section -->
            <div class="map-section">
                <div class="map-header">
                    <h2>Find Us</h2>
                    <p>Visit our campus office for direct assistance with your travel plans.</p>
                </div>
                <div class="map-container">
                    <div class="map-placeholder">
                        <i class="fas fa-map-marked-alt"></i>
                        <h3>NEUB Campus Location</h3>
                        <p>Telihaor, Sheikhghat, Sylhet</p>
                        <p>Interactive Map</p>
                        <div class="map-features">
                            <div class="map-feature">
                                <i class="fas fa-bus"></i>
                                <span>Bus Stop: 5min walk</span>
                            </div>
                            <div class="map-feature">
                                <i class="fas fa-parking"></i>
                                <span>Parking Available</span>
                            </div>
                            <div class="map-feature">
                                <i class="fas fa-wheelchair"></i>
                                <span>Accessible</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="location-details">
                    <h4>Getting Here</h4>
                    <div class="transport-options">
                        <div class="transport-option">
                            <i class="fas fa-bus"></i>
                            <div>
                                <strong>By Bus:</strong>
                                <span>Take any bus going to Sheikhghat and get down at NEUB stop</span>
                            </div>
                        </div>
                        <div class="transport-option">
                            <i class="fas fa-taxi"></i>
                            <div>
                                <strong>By CNG/Auto:</strong>
                                <span>Available from any point in Sylhet city</span>
                            </div>
                        </div>
                        <div class="transport-option">
                            <i class="fas fa-car"></i>
                            <div>
                                <strong>By Car:</strong>
                                <span>Ample parking space available inside campus</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <div class="title">
            <h1>Frequently Asked Questions</h1>
            <p>Quick answers to common questions</p>
        </div>
        <div class="faq-container">
            <div class="faq-item">
                <div class="faq-question">
                    <h3>How do I book a trip?</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>You can book trips through our website by visiting the Packages page, selecting your desired trip, and completing the registration form. Alternatively, visit our office during working hours for direct booking assistance.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <h3>What payment methods do you accept?</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>We accept cash payments at our office, mobile banking (bKash, Nagad), and bank transfers. Online payment options are coming soon!</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <h3>Can I get a refund if I cancel my trip?</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Refunds are available if cancellation is made at least 48 hours before the trip departure time. A small processing fee may apply. No refunds for cancellations within 48 hours of departure.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <h3>Do you offer group discounts?</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes! We offer special discounts for groups of 5 or more people. Student clubs and departments can also avail additional discounts for educational trips.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <h3>What should I bring on the trips?</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>We recommend bringing comfortable clothing, walking shoes, water bottle, sunscreen, and your student ID. For overnight trips, we provide a detailed packing list upon booking.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Emergency Contact Section -->
    <section class="emergency-section">
        <div class="emergency-card">
            <div class="emergency-icon">
                <i class="fas fa-phone-alt"></i>
            </div>
            <div class="emergency-content">
                <h2>Emergency Contact</h2>
                <p>For urgent assistance during trips or after office hours</p>
                <div class="emergency-numbers">
                    <div class="emergency-number">
                        <strong>Tour Guide:</strong>
                        <span>+880 01712345678</span>
                    </div>
                    <div class="emergency-number">
                        <strong>Coordinator:</strong>
                        <span>+880 01898765432</span>
                    </div>
                    <div class="emergency-number">
                        <strong>Office Emergency:</strong>
                        <span>+880 02996631220</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}
</div>

<style>
/* Main Content */
.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

.title {
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 2px solid #eaeaea;
}

.title h1 {
    color: #49a078;
    font-size: 2.2rem;
    margin-bottom: 10px;
}

.title p {
    color: #52b788;
    font-size: larger;
    max-width: 600px;
}

/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, var(--primary), #28a65e);
    color: white;
    padding: 80px 40px;
    border-radius: 15px;
    text-align: center;
    margin-bottom: 60px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.hero-content h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.hero-content p {
    font-size: 1.3rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
}

/* Contact Info Section */
.contact-info {
    margin-bottom: 60px;
}

.info-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
}

.info-card {
    background: white;
    padding: 40px 30px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
    border-top: 5px solid var(--primary);
}

.info-card:hover {
    transform: translateY(-10px);
}

.info-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary), #28a65e);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 25px;
    color: white;
    font-size: 30px;
}

.info-card h3 {
    color: #2c3e50;
    font-size: 1.5rem;
    margin-bottom: 20px;
}

.info-card p {
    color: #7f8c8d;
    margin-bottom: 8px;
    line-height: 1.5;
}

/* Contact Main Section */
.contact-main {
    margin-bottom: 60px;
}

.contact-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 50px;
    align-items: start;
}

/* Form Section */
.form-section {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
}

.form-header {
    margin-bottom: 30px;
    text-align: center;
}

.form-header h2 {
    color: #49a078;
    font-size: 2rem;
    margin-bottom: 10px;
}

.form-header p {
    color: #7f8c8d;
}

.contact-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 8px;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 12px 15px;
    border: 2px solid #eaeaea;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 3px rgba(41, 163, 92, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
}

.submit-btn {
    background: linear-gradient(135deg, var(--primary), #28a65e);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.submit-btn:hover {
    background: linear-gradient(135deg, #28a65e, var(--primary));
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

/* Map Section */
.map-section {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
}

.map-header {
    margin-bottom: 30px;
    text-align: center;
}

.map-header h2 {
    color: #49a078;
    font-size: 2rem;
    margin-bottom: 10px;
}

.map-header p {
    color: #7f8c8d;
}

.map-container {
    margin-bottom: 30px;
}

.map-placeholder {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 60px 40px;
    text-align: center;
    color: white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.map-placeholder i {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.9;
}

.map-placeholder h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.map-placeholder p {
    margin-bottom: 8px;
    opacity: 0.9;
}

.map-features {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 25px;
    flex-wrap: wrap;
}

.map-feature {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.2);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.location-details h4 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.3rem;
}

.transport-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.transport-option {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.transport-option:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.transport-option i {
    color: var(--primary);
    font-size: 1.2rem;
    margin-top: 2px;
}

.transport-option div {
    display: flex;
    flex-direction: column;
}

.transport-option strong {
    color: #2c3e50;
    margin-bottom: 5px;
}

.transport-option span {
    color: #7f8c8d;
    font-size: 0.9rem;
}

/* FAQ Section */
.faq-section {
    margin-bottom: 60px;
}

.faq-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.faq-item {
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    overflow: hidden;
}

.faq-question {
    padding: 25px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.faq-question:hover {
    background: #f8f9fa;
}

.faq-question h3 {
    color: #2c3e50;
    font-size: 1.1rem;
    margin: 0;
}

.faq-question i {
    color: var(--primary);
    transition: transform 0.3s ease;
}

.faq-answer {
    padding: 0 30px;
    max-height: 0;
    overflow: hidden;
    transition: all 0.3s ease;
}

.faq-answer.active {
    padding: 0 30px 25px 30px;
    max-height: 500px;
}

.faq-answer p {
    color: #7f8c8d;
    line-height: 1.7;
    margin: 0;
}

/* Emergency Section */
.emergency-section {
    margin-bottom: 60px;
}

.emergency-card {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    padding: 50px 40px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.emergency-icon {
    width: 100px;
    height: 100px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
}

.emergency-content h2 {
    font-size: 2rem;
    margin-bottom: 10px;
}

.emergency-content p {
    opacity: 0.9;
    margin-bottom: 25px;
    font-size: 1.1rem;
}

.emergency-numbers {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.emergency-number {
    display: flex;
    gap: 15px;
    align-items: center;
    font-size: 1.1rem;
}

.emergency-number strong {
    min-width: 150px;
}

/* Responsive Styles */
@media screen and (max-width: 768px) {
    .hero-content h1 {
        font-size: 2.2rem;
    }
    
    .hero-content p {
        font-size: 1.1rem;
    }
    
    .contact-wrapper {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .info-container {
        grid-template-columns: 1fr;
    }
    
    .emergency-card {
        flex-direction: column;
        text-align: center;
        gap: 25px;
    }
    
    .map-features {
        flex-direction: column;
        align-items: center;
    }
}

@media screen and (max-width: 480px) {
    .hero-section {
        padding: 50px 20px;
    }
    
    .hero-content h1 {
        font-size: 1.8rem;
    }
    
    .form-section,
    .map-section {
        padding: 25px;
    }
    
    .map-placeholder {
        padding: 40px 25px;
    }
    
    .emergency-card {
        padding: 30px 25px;
    }
    
    .emergency-number {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // FAQ Toggle functionality
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            const icon = question.querySelector('i');
            
            // Toggle current answer
            answer.classList.toggle('active');
            icon.classList.toggle('fa-chevron-up');
            icon.classList.toggle('fa-chevron-down');
            
            // Close other answers
            document.querySelectorAll('.faq-answer').forEach(otherAnswer => {
                if (otherAnswer !== answer) {
                    otherAnswer.classList.remove('active');
                    otherAnswer.previousElementSibling.querySelector('i').classList.remove('fa-chevron-up');
                    otherAnswer.previousElementSibling.querySelector('i').classList.add('fa-chevron-down');
                }
            });
        });
    });

    // Form submission - only if form exists (not admin view)
    const contactForm = document.querySelector('.contact-form');
    if (contactForm) {
        // Form is now handled by Django - no need for JS submission prevention
    }
    
    // Action button hover effects for admin view
    document.querySelectorAll('.action-btn').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
        });
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
});
</script>
{% endblock %}