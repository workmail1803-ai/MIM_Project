{% extends 'base.html' %}
{% load static %}

{% block title %}{{ category_name }} - Wond'r NEUB{% endblock %}

{% block content %}
<section class="packages-section" style="padding: 40px 20px; max-width: 1400px; margin: 0 auto;">
    <!-- Category Header -->
    <div style="text-align: center; margin-bottom: 40px;">
        <div style="display: inline-flex; align-items: center; justify-content: center; width: 80px; height: 80px; background: var(--primary); border-radius: 50%; margin-bottom: 20px;">
            <i class="fas {{ category_icon }}" style="font-size: 36px; color: white;"></i>
        </div>
        <h1 style="color: var(--dark); margin-bottom: 15px; font-size: 2.5rem;">{{ category_name }}</h1>
        <p style="color: #666; font-size: 1.2rem; font-style: italic; max-width: 600px; margin: 0 auto;">{{ category_description }}</p>
    </div>
    
    {% if messages %}
    <div style="max-width: 800px; margin: 0 auto 30px;">
        {% for message in messages %}
        <div class="alert" style="padding: 15px 20px; border-radius: 8px; margin-bottom: 10px; {% if message.tags == 'success' %}background: #d4edda; color: #155724; border: 1px solid #c3e6cb;{% elif message.tags == 'error' %}background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;{% else %}background: #fff3cd; color: #856404; border: 1px solid #ffeeba;{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Admin Add Package Button -->
    {% if user.is_staff or user.is_superuser %}
    <div style="text-align: center; margin-bottom: 30px;">
        <a href="{% url 'add_package' %}?category={{ category_slug }}" style="display: inline-block; background: var(--primary); color: white; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s;">
            <i class="fas fa-plus"></i> Add New Package
        </a>
    </div>
    {% endif %}
    
    {% if tour_packages %}
    <div class="packages-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 30px;">
        {% for package in tour_packages %}
        <div class="package-card" style="background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
            <div style="position: relative; height: 220px; overflow: hidden;">
                {% if package.image %}
                <img src="{{ package.image.url }}" alt="{{ package.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--dark)); display: flex; align-items: center; justify-content: center;">
                    <i class="fas {{ category_icon }}" style="font-size: 60px; color: white; opacity: 0.5;"></i>
                </div>
                {% endif %}
                <div style="position: absolute; top: 15px; right: 15px; background: var(--primary); color: white; padding: 8px 15px; border-radius: 20px; font-weight: 700;">
                    ৳{{ package.price|floatformat:0 }}
                </div>
            </div>
            
            <div style="padding: 20px;">
                <h3 style="color: var(--dark); margin-bottom: 10px; font-size: 1.3rem;">{{ package.name }}</h3>
                <p style="color: #666; font-size: 0.95rem; margin-bottom: 15px; line-height: 1.5;">{{ package.description|truncatewords:25 }}</p>
                
                <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                    <span style="color: #666; font-size: 0.9rem;">
                        <i class="fas fa-map-marker-alt" style="color: var(--primary);"></i> {{ package.destination }}
                    </span>
                    <span style="color: #666; font-size: 0.9rem;">
                        <i class="fas fa-clock" style="color: var(--primary);"></i> {{ package.duration }}
                    </span>
                </div>
                
                {% if package.highlights %}
                <div style="margin-bottom: 15px;">
                    {% for highlight in package.highlights.split %}
                    {% if forloop.counter <= 3 %}
                    <span style="display: inline-block; background: #e8f5e9; color: var(--primary); padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; margin: 3px;">{{ highlight }}</span>
                    {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button type="button" onclick="openPackageModal({{ package.id }})" style="flex: 1; background: #f8f9fa; color: var(--dark); border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                    {% if not user.is_staff and not user.is_superuser %}
                    <a href="{% url 'book_package' package.id %}" style="flex: 1; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; text-decoration: none; text-align: center; transition: all 0.3s;">
                        <i class="fas fa-calendar-check"></i> Book Now
                    </a>
                    {% endif %}
                </div>
                
                {% if user.is_staff or user.is_superuser %}
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <a href="{% url 'edit_package' package.id %}" style="flex: 1; background: #ffc107; color: #333; padding: 10px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600; font-size: 0.9rem;">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <a href="{% url 'delete_package' package.id %}" onclick="return confirm('Are you sure you want to delete this package?');" style="flex: 1; background: #dc3545; color: white; padding: 10px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600; font-size: 0.9rem;">
                        <i class="fas fa-trash"></i> Delete
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 15px; max-width: 600px; margin: 0 auto;">
        <i class="fas {{ category_icon }}" style="font-size: 60px; color: #ccc; margin-bottom: 20px;"></i>
        <h3 style="color: #666; margin-bottom: 10px;">No Packages Available</h3>
        <p style="color: #999; margin-bottom: 20px;">There are no {{ category_name|lower }} available at the moment. Check back soon!</p>
        <a href="{% url 'home' %}" style="display: inline-block; background: var(--primary); color: white; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            <i class="fas fa-home"></i> Back to Home
        </a>
    </div>
    {% endif %}
</section>

<!-- Package Detail Modal -->
{% for package in tour_packages %}
<div id="packageModal{{ package.id }}" class="package-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); overflow-y: auto;">
    <div style="background: white; margin: 30px auto; max-width: 800px; border-radius: 15px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        <div style="position: relative;">
            {% if package.image %}
            <img src="{{ package.image.url }}" alt="{{ package.name }}" style="width: 100%; height: 300px; object-fit: cover;">
            {% else %}
            <div style="width: 100%; height: 300px; background: linear-gradient(135deg, var(--primary), var(--dark)); display: flex; align-items: center; justify-content: center;">
                <i class="fas {{ category_icon }}" style="font-size: 80px; color: white; opacity: 0.5;"></i>
            </div>
            {% endif %}
            <button onclick="closePackageModal({{ package.id }})" style="position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px;">
                &times;
            </button>
            <div style="position: absolute; bottom: 15px; left: 15px; background: var(--primary); color: white; padding: 10px 20px; border-radius: 25px; font-weight: 700; font-size: 1.3rem;">
                ৳{{ package.price|floatformat:0 }}
            </div>
        </div>
        
        <div style="padding: 30px;">
            <h2 style="color: var(--dark); margin-bottom: 15px;">{{ package.name }}</h2>
            
            <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                <span style="background: #e8f5e9; color: var(--primary); padding: 8px 15px; border-radius: 20px;">
                    <i class="fas fa-map-marker-alt"></i> {{ package.destination }}
                </span>
                <span style="background: #e3f2fd; color: #1976D2; padding: 8px 15px; border-radius: 20px;">
                    <i class="fas fa-clock"></i> {{ package.duration }}
                </span>
                <span style="background: #fff3e0; color: #f57c00; padding: 8px 15px; border-radius: 20px;">
                    <i class="fas fa-tag"></i> {{ package.get_category_display }}
                </span>
            </div>
            
            <h4 style="color: var(--dark); margin-bottom: 10px;">Description</h4>
            <p style="color: #666; line-height: 1.7; margin-bottom: 20px;">{{ package.description }}</p>
            
            {% if package.highlights %}
            <h4 style="color: var(--dark); margin-bottom: 10px;">Highlights</h4>
            <ul style="color: #666; margin-bottom: 20px; padding-left: 20px;">
                {% for highlight in package.highlights.splitlines %}
                <li style="margin-bottom: 8px;">{{ highlight }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            
            {% if not user.is_staff and not user.is_superuser %}
            <a href="{% url 'book_package' package.id %}" style="display: block; text-align: center; background: var(--primary); color: white; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: 700; font-size: 1.1rem; transition: all 0.3s;">
                <i class="fas fa-calendar-check"></i> Book This Package
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}

<style>
    .package-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    @media (max-width: 768px) {
        .packages-grid {
            grid-template-columns: 1fr !important;
        }
    }
</style>

<script>
function openPackageModal(packageId) {
    document.getElementById('packageModal' + packageId).style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closePackageModal(packageId) {
    document.getElementById('packageModal' + packageId).style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modals = document.querySelectorAll('.package-modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
}
</script>
{% endblock %}
